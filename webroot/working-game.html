<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UpPaws Animal Trainer - Working Version</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .game {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            backdrop-filter: blur(10px);
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .title {
            font-size: 2rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .animal {
            font-size: 5rem;
            margin: 20px 0;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .hint {
            font-size: 1.2rem;
            margin-bottom: 25px;
            opacity: 0.9;
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 10px;
        }
        
        .slots {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        
        .slot {
            width: 55px;
            height: 55px;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            border: 3px solid #4ECDC4;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .slot:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(78, 205, 196, 0.4);
        }
        
        .slot.filled {
            background: #4ECDC4;
            color: white;
            transform: scale(1.1);
        }
        
        .letters {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        
        .letter {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, #FF6B35, #F7931E);
            color: white;
            border: none;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }
        
        .letter:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 10px 25px rgba(255, 107, 53, 0.5);
        }
        
        .letter:active {
            transform: translateY(-2px) scale(0.95);
        }
        
        .letter.used {
            opacity: 0.4;
            cursor: not-allowed;
            transform: scale(0.9);
        }
        
        .letter.used:hover {
            transform: scale(0.9);
        }
        
        .buttons {
            margin: 25px 0;
        }
        
        .btn {
            background: linear-gradient(135deg, #FF6B35, #F7931E);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-weight: bold;
            cursor: pointer;
            margin: 0 8px;
            transition: all 0.3s ease;
            font-size: 1rem;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 107, 53, 0.5);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 1.3rem;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result.correct {
            background: rgba(39, 174, 96, 0.9);
            border: 2px solid #27AE60;
        }
        
        .result.incorrect {
            background: rgba(231, 76, 60, 0.9);
            border: 2px solid #E74C3C;
        }
        
        .result.hint {
            background: rgba(241, 196, 15, 0.9);
            border: 2px solid #F1C40F;
            color: #333;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .stat {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .working-indicator {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(39, 174, 96, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            z-index: 1000;
        }
        
        @media (max-width: 600px) {
            .game {
                padding: 20px;
                margin: 10px;
            }
            
            .title {
                font-size: 1.5rem;
            }
            
            .animal {
                font-size: 4rem;
            }
            
            .slot, .letter {
                width: 45px;
                height: 45px;
                font-size: 1.5rem;
            }
            
            .btn {
                padding: 12px 24px;
                margin: 5px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="working-indicator">‚úÖ WORKING VERSION</div>
    
    <div class="game">
        <div class="title">üêæ UpPaws Animal Trainer</div>
        
        <div class="stats">
            <div class="stat">üë§ <span id="username">Player</span></div>
            <div class="stat">‚≠ê <span id="score">0</span></div>
            <div class="stat">üî• <span id="streak">0</span></div>
        </div>
        
        <div class="animal" id="animal">ü¶ä</div>
        <div class="hint" id="hint">Click the letters below to spell the animal name!</div>
        
        <div class="slots" id="slots">
            <!-- Answer slots will appear here -->
        </div>
        
        <div class="letters" id="letters">
            <!-- Letter tiles will appear here -->
        </div>
        
        <div class="buttons">
            <button class="btn btn-secondary" onclick="showHint()">üí° Hint</button>
            <button class="btn btn-secondary" onclick="clearAnswer()">üîÑ Clear</button>
            <button class="btn" onclick="submitAnswer()">‚úÖ Submit</button>
        </div>
        
        <div id="result" class="result" style="display: none;"></div>
    </div>

    <script>
        console.log('üéÆ UpPaws Animal Trainer - Working Version Loading...');
        
        // Game data
        const puzzles = [
            { answer: 'FOX', emoji: 'ü¶ä', hint: 'A clever forest animal with a bushy tail' },
            { answer: 'WOLF', emoji: 'üê∫', hint: 'A pack hunter that howls at the moon' },
            { answer: 'BEAR', emoji: 'üêª', hint: 'A large, powerful forest dweller' },
            { answer: 'EAGLE', emoji: 'ü¶Ö', hint: 'A majestic bird of prey that soars high' },
            { answer: 'TIGER', emoji: 'üêØ', hint: 'A striped big cat from Asia' },
            { answer: 'LION', emoji: 'ü¶Å', hint: 'The king of the jungle' },
            { answer: 'ELEPHANT', emoji: 'üêò', hint: 'The largest land animal with a trunk' },
            { answer: 'GIRAFFE', emoji: 'ü¶í', hint: 'The tallest animal with a long neck' }
        ];
        
        let currentPuzzle = null;
        let userAnswer = [];
        let score = 0;
        let streak = 0;
        
        // Initialize game immediately
        function initGame() {
            console.log('üöÄ Starting UpPaws Animal Trainer...');
            
            // Send ready message to parent
            try {
                if (window.parent && window.parent.postMessage) {
                    window.parent.postMessage({ type: 'webViewReady' }, '*');
                    console.log('üì§ Sent webViewReady message');
                }
            } catch (error) {
                console.log('‚ÑπÔ∏è Not in iframe, running standalone');
            }
            
            startNewPuzzle();
        }
        
        function startNewPuzzle() {
            console.log('üéØ Starting new puzzle...');
            
            // Select random puzzle
            const puzzle = puzzles[Math.floor(Math.random() * puzzles.length)];
            currentPuzzle = {
                answer: puzzle.answer,
                emoji: puzzle.emoji,
                hint: puzzle.hint,
                letters: shuffleArray(puzzle.answer.split(''))
            };
            
            console.log('üß© New puzzle:', currentPuzzle.answer, currentPuzzle.emoji);
            
            // Update UI
            document.getElementById('animal').textContent = currentPuzzle.emoji;
            document.getElementById('hint').textContent = currentPuzzle.hint;
            
            // Build game board
            buildBoard();
            
            // Clear result
            document.getElementById('result').style.display = 'none';
            userAnswer = [];
            
            console.log('‚úÖ Puzzle ready!');
        }
        
        function buildBoard() {
            console.log('üî® Building game board...');
            
            const slotsEl = document.getElementById('slots');
            const lettersEl = document.getElementById('letters');
            
            if (!slotsEl || !lettersEl) {
                console.error('‚ùå Could not find slots or letters elements!');
                return;
            }
            
            // Clear existing
            slotsEl.innerHTML = '';
            lettersEl.innerHTML = '';
            
            // Create answer slots
            console.log('üì¶ Creating', currentPuzzle.answer.length, 'answer slots');
            for (let i = 0; i < currentPuzzle.answer.length; i++) {
                const slot = document.createElement('div');
                slot.className = 'slot';
                slot.id = 'slot-' + i;
                slot.onclick = () => removeFromSlot(i);
                slot.title = 'Click to remove letter';
                slotsEl.appendChild(slot);
            }
            
            // Create letter tiles
            console.log('üî§ Creating letter tiles:', currentPuzzle.letters);
            currentPuzzle.letters.forEach((letter, index) => {
                const tile = document.createElement('div');
                tile.className = 'letter';
                tile.id = 'letter-' + index;
                tile.textContent = letter;
                tile.onclick = () => selectLetter(index);
                tile.title = 'Click to place letter';
                lettersEl.appendChild(tile);
            });
            
            console.log('‚úÖ Board built successfully!');
        }
        
        function selectLetter(index) {
            console.log('üéØ Selecting letter at index:', index);
            
            const tile = document.getElementById('letter-' + index);
            if (!tile || tile.classList.contains('used')) {
                console.log('‚ùå Letter already used or not found');
                return;
            }
            
            const letter = tile.textContent;
            const emptySlot = document.querySelector('.slot:not(.filled)');
            
            if (emptySlot) {
                emptySlot.textContent = letter;
                emptySlot.classList.add('filled');
                emptySlot.dataset.letterIndex = index;
                tile.classList.add('used');
                userAnswer.push(letter);
                
                console.log('‚úÖ Letter placed:', letter, 'Current answer:', userAnswer.join(''));
            } else {
                console.log('‚ùå No empty slots available');
            }
        }
        
        function removeFromSlot(slotIndex) {
            console.log('üóëÔ∏è Removing from slot:', slotIndex);
            
            const slot = document.getElementById('slot-' + slotIndex);
            if (!slot || !slot.textContent) {
                console.log('‚ùå Slot empty or not found');
                return;
            }
            
            const letterIndex = slot.dataset.letterIndex;
            const tile = document.getElementById('letter-' + letterIndex);
            
            if (tile) {
                // Clear slot
                const letter = slot.textContent;
                slot.textContent = '';
                slot.classList.remove('filled');
                delete slot.dataset.letterIndex;
                
                // Restore letter
                tile.classList.remove('used');
                
                // Remove from answer
                const answerIndex = userAnswer.indexOf(letter);
                if (answerIndex > -1) {
                    userAnswer.splice(answerIndex, 1);
                }
                
                console.log('‚úÖ Letter removed, current answer:', userAnswer.join(''));
            }
        }
        
        function clearAnswer() {
            console.log('üßπ Clearing all answers...');
            
            // Clear all slots
            for (let i = 0; i < currentPuzzle.answer.length; i++) {
                const slot = document.getElementById('slot-' + i);
                if (slot && slot.textContent) {
                    const letterIndex = slot.dataset.letterIndex;
                    const tile = document.getElementById('letter-' + letterIndex);
                    if (tile) {
                        tile.classList.remove('used');
                    }
                    slot.textContent = '';
                    slot.classList.remove('filled');
                    delete slot.dataset.letterIndex;
                }
            }
            
            userAnswer = [];
            console.log('‚úÖ All answers cleared');
        }
        
        function showHint() {
            console.log('üí° Showing hint...');
            const firstLetter = currentPuzzle.answer[0];
            showResult(`üí° Hint: The animal starts with "${firstLetter}"`, 'hint');
        }
        
        function submitAnswer() {
            console.log('üìù Submitting answer...');
            
            const userWord = userAnswer.join('');
            const isCorrect = userWord === currentPuzzle.answer;
            
            console.log('üéØ User answer:', userWord);
            console.log('‚úÖ Correct answer:', currentPuzzle.answer);
            console.log('üèÜ Is correct:', isCorrect);
            
            if (isCorrect) {
                score += 100;
                streak += 1;
                showResult(`üéâ Correct! It's a ${currentPuzzle.answer}!`, 'correct');
                
                // Send success message to parent
                try {
                    if (window.parent && window.parent.postMessage) {
                        window.parent.postMessage({
                            type: 'puzzleComplete',
                            data: { correct: true, answer: currentPuzzle.answer, score: score }
                        }, '*');
                        console.log('üì§ Sent success message to parent');
                    }
                } catch (error) {
                    console.log('‚ÑπÔ∏è Could not send message to parent');
                }
                
            } else {
                streak = 0;
                showResult(`‚ùå Try again! The answer was ${currentPuzzle.answer}`, 'incorrect');
                
                // Send failure message to parent
                try {
                    if (window.parent && window.parent.postMessage) {
                        window.parent.postMessage({
                            type: 'puzzleComplete',
                            data: { correct: false, answer: currentPuzzle.answer, userAnswer: userWord }
                        }, '*');
                        console.log('üì§ Sent failure message to parent');
                    }
                } catch (error) {
                    console.log('‚ÑπÔ∏è Could not send message to parent');
                }
            }
            
            updateStats();
            
            // Start new puzzle after delay
            setTimeout(() => {
                console.log('üîÑ Starting next puzzle...');
                startNewPuzzle();
            }, 3000);
        }
        
        function showResult(message, type) {
            console.log('üì¢ Showing result:', message, type);
            const resultEl = document.getElementById('result');
            resultEl.textContent = message;
            resultEl.className = 'result ' + type;
            resultEl.style.display = 'block';
        }
        
        function updateStats() {
            document.getElementById('score').textContent = score;
            document.getElementById('streak').textContent = streak;
            console.log('üìä Stats updated - Score:', score, 'Streak:', streak);
        }
        
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        // Handle messages from parent
        window.addEventListener('message', (event) => {
            try {
                const message = event.data;
                console.log('üì® Received message from parent:', message);
                
                if (message.type === 'initialData') {
                    const { username, userScore, userStreak } = message.data;
                    document.getElementById('username').textContent = username || 'Player';
                    score = userScore || 0;
                    streak = userStreak || 0;
                    updateStats();
                    console.log('‚úÖ Initial data loaded');
                }
            } catch (error) {
                console.error('‚ùå Error handling message:', error);
            }
        });
        
        // Multiple initialization attempts
        console.log('üé¨ Setting up game initialization...');
        
        // Start immediately if DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initGame);
        } else {
            initGame();
        }
        
        // Fallback initialization
        setTimeout(initGame, 100);
        setTimeout(initGame, 500);
        setTimeout(initGame, 1000);
        
        console.log('üéÆ UpPaws Animal Trainer script loaded!');
    </script>
</body>
</html>